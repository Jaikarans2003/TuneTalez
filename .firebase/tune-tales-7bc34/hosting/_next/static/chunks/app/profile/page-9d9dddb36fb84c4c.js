(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{63:(e,r,t)=>{"use strict";var a=t(7260);t.o(a,"useParams")&&t.d(r,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},1990:(e,r,t)=>{"use strict";t.d(r,{HA:()=>x,KC:()=>n,KJ:()=>l,QC:()=>b,VM:()=>d,Vz:()=>i,be:()=>h,cP:()=>c,iC:()=>m,v_:()=>u,zy:()=>p});var a=t(5300),o=t(9708),s=t(9996);let l=async(e,r)=>{try{let t=(0,s.KR)(a.IG,"pdfs/".concat(e.name)),l=(0,s.bp)(t,e);return new Promise((t,n)=>{l.on("state_changed",e=>{let t=e.bytesTransferred/e.totalBytes*100;console.log("Upload is "+t+"% done"),r&&r(t)},e=>{console.error("Upload failed:",e),n(e)},async()=>{let r=await (0,s.qk)(l.snapshot.ref),n={name:e.name,url:r,createdAt:Date.now()},c=await (0,o.gS)((0,o.rJ)(a.db,"pdfs"),n);t({...n,id:c.id})})})}catch(e){throw console.error("Error uploading PDF:",e),e}},n=async()=>{try{let e=(0,o.P)((0,o.rJ)(a.db,"pdfs"),(0,o.My)("createdAt","desc"));return(await (0,o.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Error getting PDFs:",e),e}},c=async e=>{try{if(!e.id)throw Error("Document ID is required");await (0,o.kd)((0,o.H9)(a.db,"pdfs",e.id));let r=(0,s.KR)(a.IG,"pdfs/".concat(e.name));await (0,s.XR)(r)}catch(e){throw console.error("Error deleting PDF:",e),e}},i=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"reader";try{let t={uid:e.uid,email:e.email||"",displayName:e.displayName||"",photoURL:e.photoURL||"",role:r,createdAt:Date.now()};return await (0,o.BN)((0,o.H9)(a.db,"users",e.uid),t,{merge:!0}),t}catch(e){throw console.error("Error creating user profile:",e),e}},d=async e=>{try{let r=await (0,o.x7)((0,o.H9)(a.db,"users",e));if(r.exists())return r.data();return null}catch(e){throw console.error("Error getting user profile:",e),e}},u=async(e,r)=>{try{await (0,o.BN)((0,o.H9)(a.db,"users",e),{role:r},{merge:!0})}catch(e){throw console.error("Error updating user role:",e),e}},h=async(e,r)=>{try{let t="".concat(Date.now(),"_").concat(e.name),o=(0,s.KR)(a.IG,"books/thumbnails/".concat(t)),l=(0,s.bp)(o,e);return new Promise((e,t)=>{l.on("state_changed",e=>{let t=e.bytesTransferred/e.totalBytes*100;console.log("Upload is "+t+"% done"),r&&r(t)},e=>{console.error("Upload failed:",e),t(e)},async()=>{let r=await (0,s.qk)(l.snapshot.ref);e(r)})})}catch(e){throw console.error("Error uploading thumbnail:",e),e}},m=async e=>{try{let r={...e,createdAt:Date.now()},t=await (0,o.gS)((0,o.rJ)(a.db,"books"),r);return{...r,id:t.id}}catch(e){throw console.error("Error creating book:",e),e}},p=async()=>{try{let e=(0,o.P)((0,o.rJ)(a.db,"books"),(0,o.My)("createdAt","desc"));return(await (0,o.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Error getting books:",e),e}},b=async e=>{try{let r=(0,o.H9)(a.db,"books",e),t=await (0,o.x7)(r);if(t.exists())return{id:t.id,...t.data()};return null}catch(e){throw console.error("Error getting book:",e),e}},x=async e=>{try{if(!e.id)throw Error("Document ID is required");if(await (0,o.kd)((0,o.H9)(a.db,"books",e.id)),e.thumbnailUrl)try{let r=e.thumbnailUrl.split("books/thumbnails/").pop();if(r){let e=(0,s.KR)(a.IG,"books/thumbnails/".concat(r));await (0,s.XR)(e)}}catch(e){console.error("Error deleting thumbnail:",e)}}catch(e){throw console.error("Error deleting book:",e),e}}},2795:(e,r,t)=>{Promise.resolve().then(t.bind(t,4345))},4345:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>i});var a=t(5155),o=t(2115),s=t(63),l=t(4901),n=t(2619),c=t.n(n);function i(){var e,r;let{user:t,profile:n,logout:i,updateRole:d}=(0,l.As)(),u=(0,s.useRouter)(),[h,m]=(0,o.useState)(!1),[p,b]=(0,o.useState)("");(0,o.useEffect)(()=>{t||h||u.push("/auth/signin")},[t,h,u]);let x=async e=>{try{m(!0),b(""),await d(e),b("Your account has been updated to ".concat(e," status"))}catch(e){b("Failed to update role. Please try again."),console.error("Error updating role:",e)}finally{m(!1)}},y=async()=>{try{await i(),u.push("/")}catch(e){console.error("Logout failed:",e)}};return t&&n?(0,a.jsx)("div",{className:"max-w-4xl mx-auto py-8 px-4",children:(0,a.jsxs)("div",{className:"bg-[#1F1F1F] rounded-lg shadow-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 bg-[#2a2a2a] border-b border-[#3a3a3a]",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-gray-600 flex items-center justify-center overflow-hidden mr-6",children:t.photoURL?(0,a.jsx)("img",{src:t.photoURL,alt:"Profile",className:"w-full h-full object-cover"}):(0,a.jsx)("span",{className:"text-3xl font-medium text-white",children:null==(e=t.email)?void 0:e.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white",children:t.displayName||(null==(r=t.email)?void 0:r.split("@")[0])}),(0,a.jsx)("p",{className:"text-gray-400",children:t.email}),(0,a.jsx)("div",{className:"mt-2 inline-block px-3 py-1 rounded-full bg-[#3a3a3a] text-sm text-white capitalize",children:n.role})]})]})}),(0,a.jsxs)("div",{className:"p-6",children:[p&&(0,a.jsx)("div",{className:"mb-6 p-4 rounded-md bg-green-900 text-white",children:p}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"Account Type"}),(0,a.jsx)("p",{className:"text-gray-400 mb-4",children:"Choose your account type based on how you want to use TuneTalez:"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,a.jsxs)("button",{onClick:()=>x("reader"),disabled:h||"reader"===n.role,className:"px-4 py-3 rounded-md flex-1 ".concat("reader"===n.role?"bg-primary text-white":"bg-[#2a2a2a] text-white hover:bg-[#3a3a3a]"," ").concat(h?"opacity-50 cursor-not-allowed":""),children:[(0,a.jsx)("div",{className:"font-semibold",children:"Reader"}),(0,a.jsx)("div",{className:"text-sm opacity-80 mt-1",children:"Access and read content"})]}),(0,a.jsxs)("button",{onClick:()=>x("author"),disabled:h||"author"===n.role,className:"px-4 py-3 rounded-md flex-1 ".concat("author"===n.role?"bg-primary text-white":"bg-[#2a2a2a] text-white hover:bg-[#3a3a3a]"," ").concat(h?"opacity-50 cursor-not-allowed":""),children:[(0,a.jsx)("div",{className:"font-semibold",children:"Author"}),(0,a.jsx)("div",{className:"text-sm opacity-80 mt-1",children:"Create and publish content"})]})]})]}),(0,a.jsxs)("div",{className:"border-t border-[#3a3a3a] pt-6 flex flex-col sm:flex-row gap-4",children:[(0,a.jsx)(c(),{href:"/",className:"px-4 py-2 bg-[#2a2a2a] text-white rounded-md text-center hover:bg-[#3a3a3a]",children:"Back to Home"}),(0,a.jsx)("button",{onClick:y,className:"px-4 py-2 bg-red-900 text-white rounded-md hover:bg-red-800",children:"Sign Out"})]})]})]})}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"p-8 bg-[#1F1F1F] rounded-lg shadow-lg max-w-md w-full text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-white",children:"Loading profile..."})]})})}},4901:(e,r,t)=>{"use strict";t.d(r,{As:()=>c,OJ:()=>d,z8:()=>i});var a=t(5155),o=t(2115),s=t(6768),l=t(1990);let n=(0,o.createContext)({user:null,profile:null,loading:!0,logout:async()=>{},updateRole:async()=>{}}),c=()=>(0,o.useContext)(n),i=()=>{let{profile:e,loading:r}=c();return!r&&(null==e?void 0:e.role)==="admin"},d=e=>{let{children:r}=e,[t,c]=(0,o.useState)(null),[i,d]=(0,o.useState)(null),[u,h]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{if(t)try{let e=await (0,l.VM)(t.uid);e||(e=await (0,l.Vz)(t)),d(e)}catch(e){console.error("Error fetching user profile:",e)}else d(null)})()},[t]),(0,o.useEffect)(()=>{let e=(0,s.Bh)(e=>{c(e),e||h(!1)});return()=>e()},[]),(0,o.useEffect)(()=>{t&&i&&h(!1)},[t,i]);let m=async()=>{await (0,s.CI)()},p=async e=>{t&&(await (0,l.v_)(t.uid,e),d(r=>r?{...r,role:e}:null))};return(0,a.jsx)(n.Provider,{value:{user:t,profile:i,loading:u,logout:m,updateRole:p},children:r})}},5300:(e,r,t)=>{"use strict";t.d(r,{IG:()=>i,db:()=>c,j2:()=>d});var a=t(2078),o=t(9708),s=t(9996),l=t(1328);let n=(0,a.Dk)().length?(0,a.Dk)()[0]:(0,a.Wp)({apiKey:"AIzaSyB7byiynZrjiqAo8NDIurtBg-MVBolYSjY",authDomain:"tune-tales-7bc34.firebaseapp.com",projectId:"tune-tales-7bc34",storageBucket:"tune-tales-7bc34.firebasestorage.app",messagingSenderId:"73380609988",appId:"1:73380609988:web:deb202818f8a602f73ee91",measurementId:"G-54939GDQH8"}),c=(0,o.aU)(n),i=(0,s.c7)(n),d=(0,l.xI)(n)},6768:(e,r,t)=>{"use strict";t.d(r,{Bh:()=>i,CI:()=>c,G6:()=>n,Hh:()=>s,Jv:()=>l});var a=t(1328),o=t(5300);let s=async(e,r)=>(0,a.eJ)(o.j2,e,r),l=async(e,r)=>(0,a.x9)(o.j2,e,r),n=async()=>{let e=new a.HF;return(0,a.df)(o.j2,e)},c=async()=>(0,a.CI)(o.j2),i=e=>(0,a.hg)(o.j2,e)}},e=>{e.O(0,[135,210,372,619,441,493,358],()=>e(e.s=2795)),_N_E=e.O()}]);