(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[994],{63:(e,r,t)=>{"use strict";var a=t(7260);t.o(a,"useParams")&&t.d(r,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},1945:(e,r,t)=>{"use strict";t.d(r,{A:()=>l});var a=t(5155),o=t(2115),s=t(1990);let l=e=>{let{onUploadSuccess:r}=e,[t,l]=(0,o.useState)(null),[n,i]=(0,o.useState)(!1),[c,d]=(0,o.useState)(0),[u,m]=(0,o.useState)(null),p=(0,o.useRef)(null),h=async()=>{if(!t)return void m("Please select a file to upload");try{i(!0),d(0),await (0,s.KJ)(t,e=>{d(e)}),l(null),i(!1),d(100),p.current&&(p.current.value=""),r()}catch(e){console.error("Error uploading file:",e),m("Failed to upload file. Please try again."),i(!1)}};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 max-w-md mx-auto",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-6 text-secondary",children:"Upload Book"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-700 mb-2",children:"Select Book File"}),(0,a.jsx)("input",{type:"file",accept:"application/pdf",onChange:e=>{var r;let t=null==(r=e.target.files)?void 0:r[0];t&&"application/pdf"===t.type?(l(t),m(null)):(l(null),m("Please select a valid PDF file"))},ref:p,className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary",disabled:n})]}),t&&(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Selected file: ",t.name]})}),u&&(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:u})}),n&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,a.jsx)("div",{className:"bg-primary h-2.5 rounded-full",style:{width:"".concat(c,"%")}})}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Uploading: ",c,"%"]})]}),(0,a.jsx)("button",{onClick:h,disabled:!t||n,className:"w-full bg-primary text-white py-2 px-4 rounded hover:bg-primary-dark transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:n?"Uploading...":"Upload Book"})]})}},1990:(e,r,t)=>{"use strict";t.d(r,{HA:()=>y,KC:()=>n,KJ:()=>l,QC:()=>b,VM:()=>d,Vz:()=>c,be:()=>m,cP:()=>i,iC:()=>p,v_:()=>u,zy:()=>h});var a=t(5300),o=t(9708),s=t(9996);let l=async(e,r)=>{try{let t=(0,s.KR)(a.IG,"pdfs/".concat(e.name)),l=(0,s.bp)(t,e);return new Promise((t,n)=>{l.on("state_changed",e=>{let t=e.bytesTransferred/e.totalBytes*100;console.log("Upload is "+t+"% done"),r&&r(t)},e=>{console.error("Upload failed:",e),n(e)},async()=>{let r=await (0,s.qk)(l.snapshot.ref),n={name:e.name,url:r,createdAt:Date.now()},i=await (0,o.gS)((0,o.rJ)(a.db,"pdfs"),n);t({...n,id:i.id})})})}catch(e){throw console.error("Error uploading PDF:",e),e}},n=async()=>{try{let e=(0,o.P)((0,o.rJ)(a.db,"pdfs"),(0,o.My)("createdAt","desc"));return(await (0,o.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Error getting PDFs:",e),e}},i=async e=>{try{if(!e.id)throw Error("Document ID is required");await (0,o.kd)((0,o.H9)(a.db,"pdfs",e.id));let r=(0,s.KR)(a.IG,"pdfs/".concat(e.name));await (0,s.XR)(r)}catch(e){throw console.error("Error deleting PDF:",e),e}},c=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"reader";try{let t={uid:e.uid,email:e.email||"",displayName:e.displayName||"",photoURL:e.photoURL||"",role:r,createdAt:Date.now()};return await (0,o.BN)((0,o.H9)(a.db,"users",e.uid),t,{merge:!0}),t}catch(e){throw console.error("Error creating user profile:",e),e}},d=async e=>{try{let r=await (0,o.x7)((0,o.H9)(a.db,"users",e));if(r.exists())return r.data();return null}catch(e){throw console.error("Error getting user profile:",e),e}},u=async(e,r)=>{try{await (0,o.BN)((0,o.H9)(a.db,"users",e),{role:r},{merge:!0})}catch(e){throw console.error("Error updating user role:",e),e}},m=async(e,r)=>{try{let t="".concat(Date.now(),"_").concat(e.name),o=(0,s.KR)(a.IG,"books/thumbnails/".concat(t)),l=(0,s.bp)(o,e);return new Promise((e,t)=>{l.on("state_changed",e=>{let t=e.bytesTransferred/e.totalBytes*100;console.log("Upload is "+t+"% done"),r&&r(t)},e=>{console.error("Upload failed:",e),t(e)},async()=>{let r=await (0,s.qk)(l.snapshot.ref);e(r)})})}catch(e){throw console.error("Error uploading thumbnail:",e),e}},p=async e=>{try{let r={...e,createdAt:Date.now()},t=await (0,o.gS)((0,o.rJ)(a.db,"books"),r);return{...r,id:t.id}}catch(e){throw console.error("Error creating book:",e),e}},h=async()=>{try{let e=(0,o.P)((0,o.rJ)(a.db,"books"),(0,o.My)("createdAt","desc"));return(await (0,o.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Error getting books:",e),e}},b=async e=>{try{let r=(0,o.H9)(a.db,"books",e),t=await (0,o.x7)(r);if(t.exists())return{id:t.id,...t.data()};return null}catch(e){throw console.error("Error getting book:",e),e}},y=async e=>{try{if(!e.id)throw Error("Document ID is required");if(await (0,o.kd)((0,o.H9)(a.db,"books",e.id)),e.thumbnailUrl)try{let r=e.thumbnailUrl.split("books/thumbnails/").pop();if(r){let e=(0,s.KR)(a.IG,"books/thumbnails/".concat(r));await (0,s.XR)(e)}}catch(e){console.error("Error deleting thumbnail:",e)}}catch(e){throw console.error("Error deleting book:",e),e}}},2305:(e,r,t)=>{Promise.resolve().then(t.bind(t,7709))},5300:(e,r,t)=>{"use strict";t.d(r,{IG:()=>c,db:()=>i,j2:()=>d});var a=t(2078),o=t(9708),s=t(9996),l=t(1328);let n=(0,a.Dk)().length?(0,a.Dk)()[0]:(0,a.Wp)({apiKey:"AIzaSyB7byiynZrjiqAo8NDIurtBg-MVBolYSjY",authDomain:"tune-tales-7bc34.firebaseapp.com",projectId:"tune-tales-7bc34",storageBucket:"tune-tales-7bc34.firebasestorage.app",messagingSenderId:"73380609988",appId:"1:73380609988:web:deb202818f8a602f73ee91",measurementId:"G-54939GDQH8"}),i=(0,o.aU)(n),c=(0,s.c7)(n),d=(0,l.xI)(n)},7709:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>n});var a=t(5155),o=t(2115),s=t(63),l=t(1945);function n(){let e=(0,s.useRouter)(),[r,t]=(0,o.useState)(!1);return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-secondary mb-8 text-center",children:"Upload Book"}),r?(0,a.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative max-w-md mx-auto",role:"alert",children:(0,a.jsx)("span",{className:"block sm:inline",children:"Book uploaded successfully! Redirecting to home page..."})}):(0,a.jsx)(l.A,{onUploadSuccess:()=>{t(!0),setTimeout(()=>{e.push("/")},2e3)}})]})}}},e=>{e.O(0,[135,210,372,441,493,358],()=>e(e.s=2305)),_N_E=e.O()}]);