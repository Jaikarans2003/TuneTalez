"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[512],{1990:(e,t,r)=>{r.d(t,{HA:()=>x,KC:()=>n,KJ:()=>o,QC:()=>b,VM:()=>d,Vz:()=>c,be:()=>g,cP:()=>i,iC:()=>h,v_:()=>u,zy:()=>m});var a=r(5300),s=r(9708),l=r(9996);let o=async(e,t)=>{try{let r=(0,l.KR)(a.IG,"pdfs/".concat(e.name)),o=(0,l.bp)(r,e);return new Promise((r,n)=>{o.on("state_changed",e=>{let r=e.bytesTransferred/e.totalBytes*100;console.log("Upload is "+r+"% done"),t&&t(r)},e=>{console.error("Upload failed:",e),n(e)},async()=>{let t=await (0,l.qk)(o.snapshot.ref),n={name:e.name,url:t,createdAt:Date.now()},i=await (0,s.gS)((0,s.rJ)(a.db,"pdfs"),n);r({...n,id:i.id})})})}catch(e){throw console.error("Error uploading PDF:",e),e}},n=async()=>{try{let e=(0,s.P)((0,s.rJ)(a.db,"pdfs"),(0,s.My)("createdAt","desc"));return(await (0,s.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Error getting PDFs:",e),e}},i=async e=>{try{if(!e.id)throw Error("Document ID is required");await (0,s.kd)((0,s.H9)(a.db,"pdfs",e.id));let t=(0,l.KR)(a.IG,"pdfs/".concat(e.name));await (0,l.XR)(t)}catch(e){throw console.error("Error deleting PDF:",e),e}},c=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"reader";try{let r={uid:e.uid,email:e.email||"",displayName:e.displayName||"",photoURL:e.photoURL||"",role:t,createdAt:Date.now()};return await (0,s.BN)((0,s.H9)(a.db,"users",e.uid),r,{merge:!0}),r}catch(e){throw console.error("Error creating user profile:",e),e}},d=async e=>{try{let t=await (0,s.x7)((0,s.H9)(a.db,"users",e));if(t.exists())return t.data();return null}catch(e){throw console.error("Error getting user profile:",e),e}},u=async(e,t)=>{try{await (0,s.BN)((0,s.H9)(a.db,"users",e),{role:t},{merge:!0})}catch(e){throw console.error("Error updating user role:",e),e}},g=async(e,t)=>{try{let r="".concat(Date.now(),"_").concat(e.name),s=(0,l.KR)(a.IG,"books/thumbnails/".concat(r)),o=(0,l.bp)(s,e);return new Promise((e,r)=>{o.on("state_changed",e=>{let r=e.bytesTransferred/e.totalBytes*100;console.log("Upload is "+r+"% done"),t&&t(r)},e=>{console.error("Upload failed:",e),r(e)},async()=>{let t=await (0,l.qk)(o.snapshot.ref);e(t)})})}catch(e){throw console.error("Error uploading thumbnail:",e),e}},h=async e=>{try{let t={...e,createdAt:Date.now()},r=await (0,s.gS)((0,s.rJ)(a.db,"books"),t);return{...t,id:r.id}}catch(e){throw console.error("Error creating book:",e),e}},m=async()=>{try{let e=(0,s.P)((0,s.rJ)(a.db,"books"),(0,s.My)("createdAt","desc"));return(await (0,s.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Error getting books:",e),e}},b=async e=>{try{let t=(0,s.H9)(a.db,"books",e),r=await (0,s.x7)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting book:",e),e}},x=async e=>{try{if(!e.id)throw Error("Document ID is required");if(await (0,s.kd)((0,s.H9)(a.db,"books",e.id)),e.thumbnailUrl)try{let t=e.thumbnailUrl.split("books/thumbnails/").pop();if(t){let e=(0,l.KR)(a.IG,"books/thumbnails/".concat(t));await (0,l.XR)(e)}}catch(e){console.error("Error deleting thumbnail:",e)}}catch(e){throw console.error("Error deleting book:",e),e}}},5300:(e,t,r)=>{r.d(t,{IG:()=>c,db:()=>i,j2:()=>d});var a=r(2078),s=r(9708),l=r(9996),o=r(1328);let n=(0,a.Dk)().length?(0,a.Dk)()[0]:(0,a.Wp)({apiKey:"AIzaSyB7byiynZrjiqAo8NDIurtBg-MVBolYSjY",authDomain:"tune-tales-7bc34.firebaseapp.com",projectId:"tune-tales-7bc34",storageBucket:"tune-tales-7bc34.firebasestorage.app",messagingSenderId:"73380609988",appId:"1:73380609988:web:deb202818f8a602f73ee91",measurementId:"G-54939GDQH8"}),i=(0,s.aU)(n),c=(0,l.c7)(n),d=(0,o.xI)(n)},9512:(e,t,r)=>{r.d(t,{A:()=>g});var a=r(5155),s=r(2115),l=r(1990),o=r(6098),n=r(7481),i=r(9148),c=r(3419),d=r(7004);let u=e=>{let{editor:t}=e;return t?(0,a.jsxs)("div",{className:"border-b border-gray-600 p-1 flex flex-wrap gap-1 bg-[#333333]",children:[(0,a.jsx)("button",{onClick:()=>t.chain().focus().toggleHeading({level:1}).run(),className:"p-1 rounded ".concat(t.isActive("heading",{level:1})?"bg-gray-700":"bg-[#444444] hover:bg-gray-600"),title:"Heading 1",children:"H1"}),(0,a.jsx)("button",{onClick:()=>t.chain().focus().toggleHeading({level:2}).run(),className:"p-1 rounded ".concat(t.isActive("heading",{level:2})?"bg-gray-700":"bg-[#444444] hover:bg-gray-600"),title:"Heading 2",children:"H2"}),(0,a.jsx)("button",{onClick:()=>t.chain().focus().setParagraph().run(),className:"p-1 rounded ".concat(t.isActive("paragraph")?"bg-gray-700":"bg-[#444444] hover:bg-gray-600"),title:"Paragraph",children:"P"}),(0,a.jsx)("span",{className:"mx-1 text-gray-500",children:"|"}),(0,a.jsx)("button",{onClick:()=>t.chain().focus().toggleBold().run(),className:"p-1 rounded ".concat(t.isActive("bold")?"bg-gray-700":"bg-[#444444] hover:bg-gray-600"),title:"Bold",children:(0,a.jsx)("strong",{children:"B"})}),(0,a.jsx)("button",{onClick:()=>t.chain().focus().toggleItalic().run(),className:"p-1 rounded ".concat(t.isActive("italic")?"bg-gray-700":"bg-[#444444] hover:bg-gray-600"),title:"Italic",children:(0,a.jsx)("em",{children:"I"})}),(0,a.jsx)("button",{onClick:()=>t.chain().focus().toggleUnderline().run(),className:"p-1 rounded ".concat(t.isActive("underline")?"bg-gray-700":"bg-[#444444] hover:bg-gray-600"),title:"Underline",children:(0,a.jsx)("u",{children:"U"})}),(0,a.jsx)("span",{className:"mx-1 text-gray-500",children:"|"}),(0,a.jsx)("button",{onClick:()=>t.chain().focus().setTextAlign("left").run(),className:"p-1 rounded ".concat(t.isActive({textAlign:"left"})?"bg-gray-700":"bg-[#444444] hover:bg-gray-600"),title:"Align left",children:"←"}),(0,a.jsx)("button",{onClick:()=>t.chain().focus().setTextAlign("center").run(),className:"p-1 rounded ".concat(t.isActive({textAlign:"center"})?"bg-gray-700":"bg-[#444444] hover:bg-gray-600"),title:"Align center",children:"↔"}),(0,a.jsx)("button",{onClick:()=>t.chain().focus().setTextAlign("right").run(),className:"p-1 rounded ".concat(t.isActive({textAlign:"right"})?"bg-gray-700":"bg-[#444444] hover:bg-gray-600"),title:"Align right",children:"→"}),(0,a.jsx)("span",{className:"mx-1 text-gray-500",children:"|"}),(0,a.jsx)("button",{onClick:()=>t.chain().focus().toggleBulletList().run(),className:"p-1 rounded ".concat(t.isActive("bulletList")?"bg-gray-700":"bg-[#444444] hover:bg-gray-600"),title:"Bullet list",children:"• List"}),(0,a.jsx)("button",{onClick:()=>t.chain().focus().toggleOrderedList().run(),className:"p-1 rounded ".concat(t.isActive("orderedList")?"bg-gray-700":"bg-[#444444] hover:bg-gray-600"),title:"Numbered list",children:"1. List"}),(0,a.jsx)("span",{className:"mx-1 text-gray-500",children:"|"}),(0,a.jsx)("button",{onClick:()=>t.chain().focus().unsetAllMarks().clearNodes().run(),className:"p-1 rounded bg-[#444444] hover:bg-gray-600",title:"Clear formatting",children:"Clear"})]}):null},g=e=>{let{onSuccess:t}=e,[r,g]=(0,s.useState)(""),[h,m]=(0,s.useState)(""),[b,x]=(0,s.useState)(""),[p,y]=(0,s.useState)(""),[f,v]=(0,s.useState)(!1),[w,j]=(0,s.useState)(""),[N,k]=(0,s.useState)(""),[A,C]=(0,s.useState)(""),[E,B]=(0,s.useState)(""),[P,S]=(0,s.useState)(null),[I,D]=(0,s.useState)(null),[H,U]=(0,s.useState)(!1),[R,q]=(0,s.useState)(0),[F,G]=(0,s.useState)(null),L=(0,s.useRef)(null),T=(0,o.hG)({extensions:[n.A,i.A.configure({types:["heading","paragraph"],alignments:["left","center","right"]}),c.A,d.A.configure({placeholder:"Write your book content here..."})],content:b,editorProps:{attributes:{class:"prose prose-invert max-w-none focus:outline-none min-h-[300px] p-4 text-white",dir:"ltr"}},onUpdate:e=>{let{editor:t}=e,r=t.getHTML();x(r),r.trim()?y(""):y("Content is required")},immediatelyRender:!1});(0,s.useEffect)(()=>{T&&v(!0)},[T]),(0,s.useEffect)(()=>{T&&T.setEditable(!H)},[H,T]);let M=async e=>{if(e.preventDefault(),r.trim())m("");else{m("Title is required"),G("Please enter a book title");return}if(w.trim())k("");else{k("Author is required"),G("Please enter an author name");return}if(b.trim())y("");else{y("Content is required"),G("Please enter book content");return}if(A.trim())B("");else{B("At least one tag is required"),G("Please add at least one tag");return}if(!P)return void G("Please upload a thumbnail image");try{U(!0),G(null);let e=await (0,l.be)(P,e=>{q(e)}),a=A.split(",").map(e=>e.trim()).filter(e=>e.length>0),s=await (0,l.iC)({title:r.trim(),content:b.trim(),author:w.trim(),tags:a,thumbnailUrl:e});console.log("Book created successfully:",s),g(""),x(""),j(""),C(""),S(null),D(null),q(0),t&&t()}catch(e){console.error("Error creating book:",e),G("Failed to create book: ".concat(e.message||"Please try again."))}finally{U(!1)}};return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-[#1F1F1F] rounded-lg shadow-md text-white",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Write a New Book"}),F&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-900 border border-red-700 text-white rounded",children:F}),(0,a.jsxs)("form",{onSubmit:M,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-300 mb-1",children:"Book Title *"}),(0,a.jsx)("input",{type:"text",id:"title",value:r,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-[#2a2a2a] text-white",placeholder:"Enter book title",disabled:H,required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"author",className:"block text-sm font-medium text-gray-300 mb-1",children:"Author Name *"}),(0,a.jsx)("input",{type:"text",id:"author",value:w,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-[#2a2a2a] text-white",placeholder:"Enter author name",disabled:H,required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-300 mb-1",children:"Tags (comma separated)"}),(0,a.jsx)("input",{type:"text",id:"tags",value:A,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-[#2a2a2a] text-white",placeholder:"fiction, fantasy, adventure",disabled:H})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Book Thumbnail *"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=L.current)?void 0:e.click()},className:"px-4 py-2 bg-[#333333] text-white rounded hover:bg-[#444444] transition-colors disabled:bg-[#222222]",disabled:H,children:"Select Image"}),(0,a.jsx)("input",{type:"file",ref:L,onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];if(!t.type.includes("image/"))return void G("Please select an image file");if(t.size>5242880)return void G("Image size should be less than 5MB");S(t),G(null);let r=new FileReader;r.onload=e=>{var t;D(null==(t=e.target)?void 0:t.result)},r.readAsDataURL(t)}},className:"hidden",accept:"image/*",disabled:H}),(0,a.jsx)("span",{className:"text-sm text-gray-400",children:P?P.name:"No file selected"})]}),I&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("img",{src:I,alt:"Thumbnail preview",className:"h-40 object-cover rounded border border-gray-300"})})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-300 mb-1",children:"Book Content *"}),(0,a.jsx)("div",{className:"border border-gray-600 rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:f?(0,a.jsxs)("div",{className:"bg-[#2a2a2a]",children:[(0,a.jsx)(u,{editor:T}),(0,a.jsx)(o.$Z,{editor:T,className:"prose-invert"})]}):(0,a.jsx)("div",{className:"w-full px-3 py-2 bg-[#2a2a2a] text-white min-h-[300px] flex items-center justify-center",children:(0,a.jsx)("p",{children:"Loading editor..."})})}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Use the toolbar to format your content"}),p&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:p})]}),H&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,a.jsx)("div",{className:"bg-primary h-2.5 rounded-full",style:{width:"".concat(R,"%")}})}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[Math.round(R),"% uploaded"]})]}),(0,a.jsxs)("button",{type:"submit",disabled:H,className:"w-full bg-primary text-white py-2 px-4 rounded hover:bg-primary-dark transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:[H?"Publishing...":"Publish Book",(0,a.jsx)("span",{className:"ml-2",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 inline",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})})]})]})]})}}}]);